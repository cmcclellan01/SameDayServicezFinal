
@{
    ViewBag.Title = "Home";
}

@model SameDayServicezFinal.Models.PortalList
@using SameDayServicezFinal.Utils
<style>
    .body-content {
        padding-top: 0 !important;
    }

    #map-projects {
        height: 42vh;
        width: 100%;
        min-height: 100%;
        max-height: none
    }

    #map-contractors {
        height: 42vh;
        width: 100%;
        min-height: 100%;
        max-height: none
    }

    .login_btn {
        width: 100%;
        background: #FF550B !important;
        color: white !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        color: grey !important;
    }

    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper
    .dataTables_filter,
    .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_processing, .dataTables_wrapper .dataTables_paginate {
        color: grey !important;
    }

    body {
        background-color: #111111 !important;
    }

    /*.carousel {
        margin-bottom: 4rem;
    }*/

    .carousel-item {
        height: 50vh;
        margin-top: 59px;
        background-size: cover;
        background-position: center center;
        /*background-image: url('https://www.samedayservicez.com/wp-content/themes/ProjectTheme/images/sc1.jpg');*/
    }

        .carousel-item h1 {
            margin: 0;
            color: white;
        }

    .main_tagLine {
        color: #222;
        text-transform: uppercase;
        font-weight: 500;
        font-family: "Raleway",Tahoma, Geneva, sans-serif;
        margin-bottom: 20px;
        /* text-shadow: 2px 2px 5px black, 2px 2px 100px black; */
        text-align: center;
    }


    .sub_tagLine {
        color: #333;
        font-weight: 500;
        text-transform: uppercase;
        font-family: 'Raleway',Arial, Helvetica, sans-serif;
        margin-bottom: 30px;
        /* text-shadow: 2px 2px 5px black, 2px 2px 100px black; */
        text-align: center;
        margin: auto;
        width: 1000px;
    }

    .main_area_homepg {
        text-align: center;
        margin: auto;
        width: 100%;
        /*padding-top: 110px;*/
    }








    .gm-style-iw {
        width: 350px !important;
        top: 15px !important;
        left: 0px !important;
        background-color: #fff;
        box-shadow: 0 1px 6px rgba(178, 178, 178, 0.6);
        border: 1px solid rgba(72, 181, 233, 0.6);
        border-radius: 2px 2px 10px 10px;
    }

    #iw-container {
        margin-bottom: 10px;
    }

        #iw-container .iw-title {
            font-family: 'Open Sans Condensed', sans-serif;
            font-size: 22px;
            font-weight: 400;
            padding: 10px;
            background-color: #48b5e9;
            color: white;
            margin: 0;
            border-radius: 2px 2px 0 0;
        }

        #iw-container .iw-content {
            font-size: 13px;
            line-height: 18px;
            font-weight: 400;
            margin-right: 1px;
            padding: 15px 5px 20px 15px;
            max-height: 140px;
            overflow-y: auto;
            overflow-x: hidden;
        }

    .iw-content img {
        float: right;
        margin: 0 5px 5px 10px;
    }

    .iw-subTitle {
        font-size: 16px;
        font-weight: 700;
        padding: 5px 0;
    }

    .iw-bottom-gradient {
        position: absolute;
        width: 326px;
        height: 25px;
        bottom: 10px;
        right: 18px;
        background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
        background: -webkit-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
        background: -moz-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
        background: -ms-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
    }

    div.register {
        position: relative;
    }

    div.register a {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        text-decoration: none; /* No underlines on the link */
        z-index: 10; /* Places the link above everything else in the div */
        background-color: #FFF; /* Fix to make div clickable in IE */
        opacity: 0; /* Fix to make div clickable in IE */
        filter: alpha(opacity=1); /* Fix to make div clickable in IE */
    }


</style>




<div class="row">
    <div class="col-md-12 form-group ">
        <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">

                <div class="carousel-item active">
                    <div class="main_area_homepg my-auto " style="background-image:url('/Content/images/sc1.jpg');height: 50vh;background-position: center center;background-size: cover;">
                        <div style="position: absolute;transform: translate(-50%, -50%);left: 50%;top: 50%;">
                            <div><h1 style="color:white;text-shadow: 2px 2px 4px #000000;">FIND WORKERS. GET YOUR PROJECT DONE FAST!</h1></div>
                            <div><h2 style="color:white;text-shadow: 2px 2px 4px #000000;">START BY POSTING A CHORE YOU NEED DONE OR REGISTER TO GET A JOB.</h2></div>
                            <div class="btn-group mx-auto">
                                <a href="@Url.Action("Register", "Account", new { IsContractor="False" })" class="btn btn-primary" style="margin:10px;">Join Us. It`s free</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="carousel-item">
                    <div class="main_area_homepg my-auto " style="background-image:url('/Content/images/sc2.jpg');height: 50vh;background-position: center center;background-size: cover;">
                        <div style="position: absolute;transform: translate(-50%, -50%);left: 50%;top: 50%;">
                            <div><h1 style="color:white;text-shadow: 2px 2px 4px #000000;" class="text-uppercase">Make money on your own schedule</h1></div>
                            <div><h2 style="color:white;text-shadow: 2px 2px 4px #000000;" class="text-uppercase">Click below to get started making money</h2></div>
                            <div class="btn-group mx-auto">
                                <a href="@Url.Action("Register", "Account", new { IsContractor="True" })" class="btn btn-primary" style="margin:10px;">Join Us. It`s free</a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>





    </div>
</div>

<div class="container">
    <div class="row align-items-center" style="height:100%">
        <div class="col-md-4 register">
            <div class="card" style="color:white !important;height:100%;margin-top:25px">
                <div class="card-header text-center text-uppercase;">
                    <a href="@Url.Action("Register", "Account", new { IsContractor="False" })">
                        <span style="fill: #FF550B;    color: #FF550B;    border-color: #FF550B;font-size: 75px;">
                            <i class="fa fa-edit" aria-hidden="true"></i>
                        </span>
                    </a>
                    <h6 class="text-uppercase" style="text-shadow: 2px 2px 4px #000000;">Post your project</h6>
                </div>
                <div class="card-body ">
                    <p class="card-text text-light">
                        Post your project easily with our easy to use interface, then wait for the contractors to submit their proposals. This way you are in total control of your offers and project as well.
                    </p>                  
                </div>
            </div>
        </div>
        <div class="col-md-4 register">
            <div class="card" style="color:white !important;height:100%;margin-top:25px">
                <div class="card-header text-center ">
                    <a href="@Url.Action("Register", "Account", new { IsContractor="False" })">
                        <span style="fill: #FF550B;    color: #FF550B;    border-color: #FF550B;font-size: 75px;">
                            <i class="fa fa-money" aria-hidden="true"></i>
                        </span>
                    </a>
                        <h6 class="text-uppercase" style="text-shadow: 2px 2px 4px #000000;"> Get proposals</h6>
                </div>
                <div class="card-body ">
                    <p class="card-text text-light">
                        After posting your project , you will wait for the contractors to post their proposals. You have until the end of the project to choose the best fit for contractor and start the work.
                    </p>  
                </div>
            </div>
        </div>
        <div class="col-md-4 register">
            <div class="card" style="color:white !important;height:100%;margin-top:25px">
                <div class="card-header text-center text-uppercase">
                    <a href="@Url.Action("Register", "Account", new { IsContractor="False" })">
                        <span style="fill: #FF550B;    color: #FF550B;    border-color: #FF550B;font-size: 75px;">
                            <i class="fa fa-check-square-o" aria-hidden="true"></i>
                        </span>
                    </a>
                        <h6 class="text-uppercase" style="text-shadow: 2px 2px 4px #000000;"> Get your project done</h6>
                </div>
                <div class="card-body ">
                    <p class="card-text text-light">
                        After choosing a contractor, your work will start. You and the contractor will be in total contact and cooperation under a secure workspace inside our site. Exchange files and messages.
                    </p>
                    @*<div class="text-center">
                            <a href="#" class="btn btn-primary">Post your Project</a>
                        </div>*@

                </div>
            </div>
        </div>
    </div>
</div>


<div class="row">

    @*this div to have links outside of the maps*@
    <div class="col-md-6" style="display:none">
        @*<div class="jumbotron " style="background-color:#212529 !important;color:grey !important;padding: 1rem 2rem;height:100%">
            <table id="example" class="display compact" style="width:100%">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @{var s = 0;}
                    @foreach (var item in Model.Projects)
                    {
                        <tr>
                            <td>
                                <a class="marker-link" data-markerid="@s" data-title="@item.ProjectTitle-@item.ProjectsId" href="#">
                                    <img style="width: 24px; height: 24px;margin:5px" src="/Content/images/project_Icon.png">
                                </a>
                            </td>
                            <td>
                                <p class="media-body pb-3 mb-0 small lh-125 ">
                                    @item.ProjectTitle
                                </p>
                            </td>
                        </tr>
                        s++;                      

                    }

            </table>

            <small class="d-block text-left mt-3">
                <a href="@Url.Action("DashBoard", "Account", new { IsContractor = Extensions.IsInContractorMode })" class="text-primary">View your Projects</a>
            </small>
        </div>*@
    </div>

    <div class="col-md-6" style="margin-top:25px">
        <div class="card " style="color:white !important;height:100%;">
            <div class="card-header">
                Current Projects
            </div>
            <div class="card-body">
                <div id="map-projects"></div>
            </div>

        </div>
    </div>

    <div class="col-md-6" style=";margin-top:25px">
        <div class="card " style="color:white !important;height:100%">
            <div class="card-header">
                Current Contractors
            </div>
            <div class="card-body">
                <div id="map-contractors"></div>
            </div>

        </div>
    </div>
</div>





<script>

    var lastWindow = null;
    var last_Window = null;
    var markers = new Array();
    var map;
    var addresess = new Array();

    function mapAddress(addresses, type) {
        var geocoder = new google.maps.Geocoder();
        var mapOptions = {
            zoom: 7,
            // this is centered over the state of iowa
            center: { lat: 41.8780025, lng: -93.09770200000003 },
            gestureHandling: 'cooperative',
            scaleControl: true,
            streetViewControl: false,
            mapTypeControl: false
        };

        var mapStyles = [
                {
                    "stylers": [
                        {
                            "hue": "#ff1a00"
                        },
                        {
                            "invert_lightness": true
                        },
                        {
                            "saturation": -80
                        },
                        {
                            "lightness": 33
                        },
                        {
                            "gamma": 0.5
                        }
                    ]
                },
                {
                    "featureType": "administrative.neighborhood",
                    "elementType": "geometry.stroke",
                    "stylers": [
                        {
                            "visibility": "on"
                        },
                        {
                            "hue": "#ff0000"
                        }
                    ]
                },
                {
                    "featureType": "water",
                    "elementType": "geometry",
                    "stylers": [
                        {
                            "color": "#2D333C"
                        }
                    ]
                },
                {
                    "featureType": "landscape.man_made",
                    "elementType": "all",
                    "stylers": [
                        {
                            "visibility": "off"
                        }
                    ]
                },

        ];

        if (type == 'p') {
            map = new google.maps.Map(document.getElementById('map-projects'), mapOptions);
            map.set('styles', mapStyles);
        }
        else {
            map = new google.maps.Map(document.getElementById('map-contractors'), mapOptions);
            map.set('styles', mapStyles);
        }

        addresses.forEach(function (item) {

                     if (type =='p') {

                         var contentString = '<div class="card border-primary">'+
                        '<div class="card-header">'+
                                '<span class=" font-weight-bold">' + item[3] + '</span>'+
                        '</div>'+
                        '<div class="card-body">'+
                            '<p class="card-text">'+
                                '<span class="text-light small">Description:</span> <span class="table-dark small">' + item[4].replace(/&quot;/g, '') + '</span>'+
                            '</p>'+
                        '</div>'+
                        '</div>';

                        var infowindow = new google.maps.InfoWindow({ content: contentString });
                        var latlng = new google.maps.LatLng(item[1],item[2]);
                        var marker = new google.maps.Marker({
                            map: map,
                            position: latlng,
                            icon:'/content/images/logo.ico',
                            title: item[3] + '-' + item[5],
                            animation: google.maps.Animation.DROP
                        });

                        marker.addListener('click', function () {
                            if (lastWindow) lastWindow.close();
                            infowindow.open(map, marker);
                            lastWindow = infowindow;
                        });

                         google.maps.event.addListener(map, 'click', function () {
                             infowindow.close();
                         });

                                               // *
                      // START INFOWINDOW CUSTOMIZE.
                      // The google.maps.event.addListener() event expects
                      // the creation of the infowindow HTML structure 'domready'
                      // and before the opening of the infowindow, defined styles are applied.
                      // *
                      google.maps.event.addListener(infowindow, 'domready', function() {

                        // Reference to the DIV that wraps the bottom of infowindow
                        var iwOuter = $('.gm-style-iw');

                        /* Since this div is in a position prior to .gm-div style-iw.
                         * We use jQuery and create a iwBackground variable,
                         * and took advantage of the existing reference .gm-style-iw for the previous div with .prev().
                        */
                        var iwBackground = iwOuter.prev();

                        // Removes background shadow DIV
                        iwBackground.children(':nth-child(2)').css({'display' : 'none'});

                        // Removes white background DIV
                        iwBackground.children(':nth-child(4)').css({'display' : 'none'});

                        // Moves the infowindow 115px to the right.
                        iwOuter.parent().parent().css({left: '115px'});

                        // Moves the shadow of the arrow 76px to the left margin.
                        iwBackground.children(':nth-child(1)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

                        // Moves the arrow 76px to the left margin.
                        iwBackground.children(':nth-child(3)').attr('style', function(i,s){ return s + 'left: 76px !important;'});

                        // Changes the desired tail shadow color.
                        iwBackground.children(':nth-child(3)').find('div').children().css({'box-shadow': 'rgba(72, 181, 233, 0.6) 0px 1px 6px', 'z-index' : '1'});

                        // Reference to the div that groups the close button elements.
                        var iwCloseBtn = iwOuter.next();

                        // Apply the desired effect to the close button
                        iwCloseBtn.css({opacity: '1', right: '38px', top: '3px', border: '7px solid #48b5e9', 'border-radius': '13px', 'box-shadow': '0 0 5px #3990B9'});

                        // If the content of infowindow not exceed the set maximum height, then the gradient is removed.
                        if($('.iw-content').height() < 140){
                          $('.iw-bottom-gradient').css({display: 'none'});
                        }

                        // The API automatically applies 0.7 opacity to the button after the mouseout event. This function reverses this event to the desired value.
                        iwCloseBtn.mouseout(function(){
                          $(this).css({opacity: '1'});
                        });
                      });



                        //$('.marker-link').on('click', function () {
                        //    google.maps.event.trigger(markers.find(p => p.title === $(this).data('title')), 'click');
                        //});

                        markers.push(marker);

                    } else {

                         var latlng = new google.maps.LatLng(item[1], item[2]);


                         var image = {
                             url: item[3],
                             // This marker is 20 pixels wide by 32 pixels high.
                            scaledSize: new google.maps.Size(50, 50),
                             // The origin for this image is (0, 0).
                             origin: new google.maps.Point(0, 0),
                             // The anchor for this image is the base of the flagpole at (0, 32).
                             anchor: new google.maps.Point(0, 32)
                         };


                         var marker = new google.maps.Marker({
                             map: map,
                             icon:image,
                             position: latlng,
                             animation: google.maps.Animation.DROP
                         });

                          markers.push(marker);
                    }
        });

         center_map(map,markers);
         addresess = [];

    }/////

    function initProjectsMap() {

        @foreach (var item in Model.Projects)
        {
             <text> addresess.push(['map-projects', '@item.latitude', ' @item.longitude', '@item.ProjectTitle', '@item.Description', '@item.ProjectsId']);</text>
        }
        mapAddress(addresess, 'p');




        @foreach (var item in Model.ContractorList)
        {
            ///

            if(@item.Contractor.ProfileImage == null)
            {
                  <text> addresess.push(['map-contractors', '@item.Contractor.latitude', ' @item.Contractor.longitude', 'Uploads/ProfileImages/bf55fc7e-0f81-4e9c-8f02-ab3ef34e6539/profile_bf55fc7e-0f81-4e9c-8f02-ab3ef34e6539.jpg','@item.Contractor.DisplayName']);
                    $('body').append('<style>img[src="/Uploads/ProfileImages/bf55fc7e-0f81-4e9c-8f02-ab3ef34e6539/profile_bf55fc7e-0f81-4e9c-8f02-ab3ef34e6539.jpg"]{border-radius:25px;border:1px solid #000 !important;} </style>')
            </text>
            }
            else
            {
                  <text> addresess.push(['map-contractors', '@item.Contractor.latitude', ' @item.Contractor.longitude', '/Uploads/ProfileImages/@item.Contractor.Id/@item.Contractor.ProfileImage','@item.Contractor.DisplayName']);
                    $('body').append('<style>img[src="/Uploads/ProfileImages/@item.Contractor.Id/@item.Contractor.ProfileImage"]{border-radius:25px;border:1px solid #000 !important;} </style>')
            </text>
            }


        }


        mapAddress(addresess,'c');
    }

    function center_map(map,markers) {
        // vars
        var bounds = new google.maps.LatLngBounds();
        // loop through all markers and create bounds
        $.each(markers, function(i, marker) {
            var latlng = new google.maps.LatLng(marker.position.lat(), marker.position.lng());
            bounds.extend(latlng);
        });
        // only 1 marker?
        if (markers.length == 1) {
            // set center of map
            map.setCenter(bounds.getCenter());
            map.setZoom(16);
        } else {
            // fit to bounds
            map.fitBounds(bounds);
        }
    }

</script>

@*<script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANM-MNjlvaju8maiq0zZbDk99JXmD_nrA&callback=initProjectsMap">
    </script>*@
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANM-MNjlvaju8maiq0zZbDk99JXmD_nrA"></script>


<script>
    $(document).ready(function () {
        initProjectsMap();
    });



    var table = $('#example').DataTable({
        "lengthChange": false,
        "iDisplayLength": 6,
        "bSort": false,
        "pagingType": "simple",
        "language": {
            "search": "Search Projects:"
        },
        "columnDefs": [
            {
                "targets": [0],
                "searchable": false,
                "orderable": false,
                "width": "20px",


            },
        ]
    });

    $('#example tbody').on('click', 'tr', function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        }
        else {
            table.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');


            google.maps.event.trigger(markers.find(p => p.title === $('.selected td a').data('title')), 'click');
        }


    });

    $('#button').click(function () {
        table.row('.selected').remove().draw(false);
    });
</script>

